#!/usr/bin/env bash
set -euo pipefail

GDRIVE_LOCAL_DIR="$HOME/sync"
GDRIVE_REMOTE_DIR="drive:AutoSync"

if ! ls "$GDRIVE_LOCAL_DIR" >/dev/null 2>&1 || [[ -z $(ls "$GDRIVE_LOCAL_DIR") ]]; then
    mkdir -p "$GDRIVE_LOCAL_DIR"
    rclone \
        bisync \
        "$GDRIVE_LOCAL_DIR" \
        "$GDRIVE_REMOTE_DIR" \
        --create-empty-src-dirs \
        --compare size,modtime,checksum \
        --slow-hash-sync-only \
        --resilient \
        -MvP \
        --drive-skip-gdocs \
        --fix-case \
        --resync
else
    rclone \
        bisync \
        "$GDRIVE_LOCAL_DIR" \
        "$GDRIVE_REMOTE_DIR" \
        --create-empty-src-dirs \
        --compare size,modtime,checksum \
        --slow-hash-sync-only \
        --resilient \
        -MvP \
        --drive-skip-gdocs \
        --force \
        --fix-case
fi
